<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist Totem</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .mobile-play-button {
            display: flex !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 9999 !important;
            background: rgba(0, 0, 0, 0.8) !important;
            padding: 20px !important;
            border-radius: 15px !important;
            cursor: pointer !important;
        }
    </style>
</head>
<body>
    <div class="container glass-effect">
        <div class="header">
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                <span>Torna alla Home</span>
            </a>
            <a href="admin.html" class="admin-button">
                <i class="fas fa-cog"></i>
                <span>Admin Panel</span>
            </a>
            <div class="logo-container">
                <img src="https://www.istitutoboselli.edu.it/wp-content/uploads/2024/04/logo-boselli-ritaglio-1.png" alt="Logo IIS P.Boselli" class="school-logo">
            </div>
            <i class="fas fa-music music-icon"></i>
            <h1>Sede Centrale - Via Montecuccoli</h1>
            <div class="subtitle">Musica in loop per il tuo ambiente</div>
        </div>
        
        <div class="player-container">
            <div id="player"></div>
            <div class="custom-play-button glass-effect">
                <i class="fas fa-play-circle"></i>
                <span>Riproduci</span>
            </div>
            <div class="player-overlay">
                <div class="player-info">
                    <i class="fas fa-play-circle"></i>
                    <span>Riproduzione in corso</span>
                </div>
            </div>
        </div>

        <div class="controls glass-effect">
            <button id="toggleLoop" class="btn">
                <i class="fas fa-sync-alt"></i>
                <span>Toggle Loop</span>
            </button>
            <div class="status-indicator">
                <i class="fas fa-circle status-dot"></i>
                <span class="status-text">Loop attivo</span>
            </div>
        </div>

        <footer class="footer glass-effect">
            <p>© 2024 Playlist Totem | IIS P.Boselli Torino | Tutti i diritti riservati</p>
            <p class="footer-sub">Progetto sviluppato presso l'Istituto di Istruzione Superiore Paolo Boselli di Torino</p>
        </footer>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let isLooping = true;
        const playlistId = 'PLJKwjtX6AccvFVv-5s9bIS6ee6Pm5hyxZ';

        // Initialize YouTube Player
        function onYouTubeIframeAPIReady() {
            try {
                const playerConfig = {
                    height: '100%',
                    width: '100%',
                    videoId: 'gfow08no7q8',
                    playerVars: {
                        'listType': 'playlist',
                        'list': playlistId,
                        'loop': 1,
                        'playlist': playlistId,
                        'controls': 1,
                        'autoplay': 0,
                        'rel': 0,
                        'showinfo': 0,
                        'modestbranding': 1,
                        'playsinline': 1,
                        'enablejsapi': 1,
                        'origin': window.location.origin
                    },
                    events: {
                        'onStateChange': onPlayerStateChange,
                        'onReady': onPlayerReady,
                        'onError': onPlayerError
                    }
                };

                player = new YT.Player('player', playerConfig);

                // Gestione del bottone play personalizzato
                const playButton = document.querySelector('.custom-play-button');
                if (playButton) {
                    playButton.addEventListener('click', () => {
                        if (player && player.playVideo) {
                            player.playVideo();
                        }
                    });
                }

            } catch (error) {
                console.error('Errore durante l\'inizializzazione del player:', error);
                showErrorMessage('Errore durante l\'inizializzazione del player. Ricarica la pagina o prova un browser diverso.');
            }
        }

        // Handle player state changes
        function onPlayerStateChange(event) {
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            const playerInfo = document.querySelector('.player-info span');
            const playButton = document.querySelector('.custom-play-button');

            switch(event.data) {
                case YT.PlayerState.PLAYING:
                    statusDot.style.color = '#4CAF50';
                    statusText.textContent = 'Riproduzione in corso';
                    playerInfo.textContent = 'Riproduzione in corso';
                    if (playButton) {
                        playButton.classList.add('hidden');
                    }
                    break;
                case YT.PlayerState.PAUSED:
                    statusDot.style.color = '#FFC107';
                    statusText.textContent = 'In pausa';
                    playerInfo.textContent = 'In pausa';
                    if (playButton) {
                        playButton.classList.remove('hidden');
                    }
                    break;
                case YT.PlayerState.ENDED:
                    if (isLooping) {
                        player.playVideo();
                    } else {
                        statusDot.style.color = '#F44336';
                        statusText.textContent = 'Riproduzione terminata';
                        playerInfo.textContent = 'Riproduzione terminata';
                        if (playButton) {
                            playButton.classList.remove('hidden');
                        }
                    }
                    break;
            }
        }

        function onPlayerReady(event) {
            // Aggiorna lo stato iniziale
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            statusDot.style.color = '#4CAF50';
            statusText.textContent = 'Riproduzione in corso';
        }

        // Toggle loop functionality
        document.getElementById('toggleLoop').addEventListener('click', function() {
            isLooping = !isLooping;
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            
            if (isLooping) {
                this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Disabilita Loop</span>';
                this.style.background = 'linear-gradient(45deg, var(--primary-color), var(--primary-dark))';
                statusDot.style.color = '#4CAF50';
                statusText.textContent = 'Loop attivo';
            } else {
                this.innerHTML = '<i class="fas fa-sync-alt"></i><span>Abilita Loop</span>';
                this.style.background = 'linear-gradient(45deg, #666666, #444444)';
                statusDot.style.color = '#F44336';
                statusText.textContent = 'Loop disattivato';
            }
        });

        // Gestione errori del player
        function onPlayerError(event) {
            console.error('Errore del player YouTube:', event.data);
            let errorMessage = 'Si è verificato un errore durante la riproduzione. ';
            
            switch(event.data) {
                case 2:
                    errorMessage += 'ID video non valido.';
                    break;
                case 5:
                    errorMessage += 'Errore HTML5. Prova un browser diverso.';
                    break;
                case 100:
                    errorMessage += 'Video non trovato o non disponibile.';
                    break;
                case 101:
                case 150:
                    errorMessage += 'Il video non può essere riprodotto in questo player.';
                    break;
                default:
                    errorMessage += 'Errore sconosciuto. Ricarica la pagina.';
            }
            
            showErrorMessage(errorMessage);
        }

        // Mostra messaggi di errore all'utente
        function showErrorMessage(message) {
            const playerContainer = document.querySelector('.player-container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message glass-effect';
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <p>${message}</p>
                <button onclick="window.location.reload()" class="btn">
                    <i class="fas fa-sync-alt"></i>
                    Ricarica pagina
                </button>
            `;
            playerContainer.appendChild(errorDiv);
        }

        // Handle errors
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Error: ' + msg + '\nURL: ' + url + '\nLine: ' + lineNo + '\nColumn: ' + columnNo + '\nError object: ' + JSON.stringify(error));
            return false;
        };

        // Inizializza le particelle quando il documento è caricato
        document.addEventListener('DOMContentLoaded', function() {
            const particlesContainer = document.createElement('div');
            particlesContainer.className = 'particles';
            document.body.appendChild(particlesContainer);

            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particlesContainer.appendChild(particle);
            }
        });
    </script>

    <script>
        // Rimuovo le funzioni del Totem Evolution
        let currentSlide = 0;
        let slides = [];
        let slideInterval = null;
        let isFullscreen = false;

        // Funzione per inizializzare il carousel
        function initializeCarousel() {
            const carousel = document.querySelector('.carousel');
            slides = Array.from(carousel.children);
            
            // Nascondi tutti i slide tranne il primo
            slides.forEach((slide, index) => {
                slide.style.display = index === 0 ? 'flex' : 'none';
            });
            
            updateSlideNumber();
            startSlideShow();
        }

        // Funzione per aggiornare il numero del slide corrente
        function updateSlideNumber() {
            const slideNumber = document.getElementById('slideNumber');
            if (slideNumber) {
                slideNumber.textContent = `${currentSlide + 1}/${slides.length}`;
            }
        }

        // Funzione per mostrare il prossimo slide
        function nextSlide() {
            slides[currentSlide].style.display = 'none';
            currentSlide = (currentSlide + 1) % slides.length;
            slides[currentSlide].style.display = 'flex';
            updateSlideNumber();
        }

        // Funzione per mostrare lo slide precedente
        function prevSlide() {
            slides[currentSlide].style.display = 'none';
            currentSlide = (currentSlide - 1 + slides.length) % slides.length;
            slides[currentSlide].style.display = 'flex';
            updateSlideNumber();
        }

        // Funzione per avviare lo slideshow automatico
        function startSlideShow() {
            if (slideInterval) {
                clearInterval(slideInterval);
            }
            slideInterval = setInterval(nextSlide, 10000); // 10 secondi per slide
        }

        // Funzione per fermare lo slideshow
        function stopSlideShow() {
            if (slideInterval) {
                clearInterval(slideInterval);
                slideInterval = null;
            }
        }

        // Gestione del fullscreen
        function toggleFullscreen() {
            const container = document.querySelector('.carousel-container');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    console.error(`Errore nell'attivazione del fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Event listener per il cambio di stato del fullscreen
        document.addEventListener('fullscreenchange', () => {
            isFullscreen = !!document.fullscreenElement;
            const container = document.querySelector('.carousel-container');
            if (isFullscreen) {
                container.classList.add('fullscreen');
            } else {
                container.classList.remove('fullscreen');
            }
        });

        // Event listener per i tasti freccia
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                prevSlide();
            } else if (e.key === 'f') {
                toggleFullscreen();
            }
        });

        // Inizializza il carousel quando il documento è caricato
        document.addEventListener('DOMContentLoaded', initializeCarousel);
    </script>

    <style>
    /* Timer Styles */
    .timer-overlay {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 0.8rem 1.5rem;
        font-size: 1.4rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 1rem;
        border-radius: 30px;
        z-index: 1000;
    }

    .timer-content {
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .timer-overlay i {
        font-size: 1.6rem;
        color: var(--primary-color);
    }

    #timerText {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        min-width: 2.5rem;
        text-align: center;
        transition: all 0.3s ease;
    }

    .timer-warning {
        color: #ff6b6b;
        animation: pulse 1s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }

    .stop-totem-btn {
        background: none;
        border: none;
        color: #ff6b6b;
        cursor: pointer;
        padding: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border-radius: 50%;
    }

    .stop-totem-btn i {
        font-size: 1.8rem;
        color: #ff6b6b;
    }

    .stop-totem-btn:hover {
        background: rgba(255, 107, 107, 0.1);
        transform: scale(1.1);
    }

    .stop-totem-btn:active {
        transform: scale(0.95);
    }

    .stop-totem-btn::after {
        content: 'Ferma il loop';
        position: absolute;
        bottom: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-size: 0.9rem;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .stop-totem-btn:hover::after {
        opacity: 1;
        visibility: visible;
        bottom: -35px;
    }

    /* Aggiungi stili per la modalità schermo intero */
    .player-container:fullscreen {
        background: #000;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .player-container:fullscreen #player {
        width: 100%;
        height: 100%;
    }

    .player-container:fullscreen .player-overlay {
        display: none;
    }

    .player-container:fullscreen .custom-play-button {
        display: none;
    }
    </style>
</body>
</html> 